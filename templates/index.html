<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة مدن فلسطين</title>
    <script>
        let locations = {{ locations | tojson | safe }};
        let stages = {{ stages | tojson | safe }};
        let maxTime = {{ time }};
        let currentStage = 0;
        let score = 0;
        let timer;

        function startGame() {
            document.getElementById("startScreen").style.display = "none";
            document.getElementById("gameScreen").style.display = "block";
            startStage();
        }

        function startStage() {
            let stage = stages[currentStage];
            document.getElementById("stageName").innerText = stage.name;
            let timeLeft = maxTime;
            document.getElementById("timer").innerText = `الوقت: ${timeLeft} ثانية`;

            timer = setInterval(() => {
                timeLeft--;
                document.getElementById("timer").innerText = `الوقت: ${timeLeft} ثانية`;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    alert("انتهى الوقت!");
                    nextStage();
                }
            }, 1000);
        }

        function checkAnswer(city) {
            fetch("/submit_answer", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ city })
            })
            .then(response => response.json())
            .then(data => {
                if (data.correct) {
                    score++;
                    alert(`صحيح! ${data.info}`);
                } else {
                    alert("إجابة خاطئة!");
                }
            })
            .catch(error => console.error("Error:", error));
        }

        function nextStage() {
            clearInterval(timer);
            if (currentStage < stages.length - 1) {
                currentStage++;
                startStage();
            } else {
                alert(`انتهت اللعبة! نتيجتك: ${score}`);
            }
        }
    </script>
</head>
<body>
    <div id="startScreen">
        <h1>مرحبًا بك في لعبة مدن فلسطين</h1>
        <button onclick="startGame()">ابدأ</button>
    </div>

    <div id="gameScreen" style="display: none;">
        <h2 id="stageName"></h2>
        <p id="timer"></p>
        <p>اختر مدينة:</p>
        <ul>
            {% for city in locations.keys() %}
                <li><button onclick="checkAnswer('{{ city }}')">{{ city }}</button></li>
            {% endfor %}
        </ul>
    </div>
</body>
</html>
