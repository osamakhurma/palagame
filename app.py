from flask import Flask, render_template, request, jsonify, session
import random

app = Flask(__name__)
app.secret_key = "supersecretkey"  # مفتاح التشفير للجلسة

# قائمة المدن والمحافظات مع الإحداثيات والمعلومات
locations = {
    "الخليل": (347, 346, "governorate", "الخليل مدينة تاريخية معروفة بصناعة الزجاج والخزف، وتحتوي على الحرم الإبراهيمي."),
    "بيت لحم": (396, 299, "city", "بيت لحم مهد السيد المسيح وتشتهر بكنيسة المهد وأسواقها القديمة."),
    "القدس": (399, 279, "city", "القدس عاصمة فلسطين وتضم المسجد الأقصى، قبة الصخرة، وكنيسة القيامة."),
    "أريحا": (430, 239, "city", "أريحا أقدم مدينة مأهولة في العالم، وتشتهر بقصر هشام وأشجار النخيل."),
    "رام الله": (380, 236, "governorate", "رام الله مركز ثقافي وسياسي هام وتضم العديد من المؤسسات الحكومية والدولية."),
    "نابلس": (390, 190, "governorate", "نابلس تشتهر بالكنافة النابلسية والصابون النابلسي، وبها جبل جرزيم."),
    "بئر السبع": (280, 416, "governorate", "بئر السبع تُعرف بعاصمة النقب وتتميز بوجود العديد من القبائل البدوية."),
    "رفح": (205, 401, "city", "رفح مدينة حدودية جنوب قطاع غزة وتشتهر بمعبرها الحدودي مع مصر."),
    "غزة": (206, 363, "city", "غزة أكبر مدن القطاع، تشتهر بالأسواق الشعبية وشاطئها الجميل."),
    "يافا": (309, 211, "city", "يافا لؤلؤة البحر الأبيض المتوسط، تشتهر بالميناء التاريخي والبرتقال اليافاوي."),
    "الرملة": (326, 249, "city", "الرملة مدينة تاريخية بناها الأمويون، وتشتهر بمسجدها الأبيض."),
    "طبريا": (444, 115, "city", "طبريا تقع على بحيرة طبريا، وتشتهر بالمياه الساخنة العلاجية والأسماك الطازجة."),
    "بيسان": (443, 162, "city", "بيسان مدينة قديمة شهدت العديد من الحضارات، وتشتهر بالزراعة وموقعها الأثري."),
    "حيفا": (336, 103, "city", "حيفا مدينة ساحلية تضم ميناءً هامًا، وتشتهر بحدائق البهائيين."),
    "عكا": (360, 77, "city", "عكا مدينة تاريخية مشهورة بصمودها ضد الغزاة، وتضم القلعة العثمانية."),
    "صفد": (441, 64, "city", "صفد مدينة جبلية تُعرف بالهواء النقي، وتشتهر بالفن والثقافة."),
    "جنين": (390, 160, "city", "جنين تشتهر بأراضيها الخصبة، ومخيم جنين الذي يعد رمزًا للصمود."),
    "الناصرة": (404, 127, "city", "الناصرة أكبر مدينة عربية داخل فلسطين المحتلة، وتشتهر بكنيسة البشارة والأسواق القديمة.")
}

def get_random_city():
    return random.choice(list(locations.keys()))

@app.route('/')
def index():
    session['score'] = 0  # إعادة تعيين السكور عند بدء اللعبة
    city = get_random_city()
    return render_template('index.html', city=city, locations=locations, score=session['score'])

@app.route('/check', methods=['POST'])
def check():
    data = request.json
    city = data['city']
    correct = city in locations
    
    if correct:
        session['score'] += 1  # زيادة السكور
        info = locations[city][3]  # جلب معلومات عن المدينة
        return jsonify({
            "result": "صح ✅", 
            "new_city": get_random_city(), 
            "score": session['score'], 
            "info": info
        })
    
    return jsonify({"result": "خطأ ❌", "score": session['score']})

if __name__ == '__main__':
    app.run(host='0.0.0.0', debug=True)
